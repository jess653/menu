<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mercado Arte & Cultura</title>
    <meta name="description" content="Tienda de productos de arte y cultura - pinceles, libros, láminas y kits creativos">
    <style>
        /* Reset básico */
        *{box-sizing:border-box}
        body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, 'Helvetica Neue', Arial; margin:0; background:#f7f6f5; color:#222}
        header{background:linear-gradient(90deg,#3b2f63,#6b4b8a); color:white; padding:20px}
        .container{max-width:1100px;margin:20px auto;padding:0 16px}
        .brand{display:flex;align-items:center;gap:12px}
        .brand h1{margin:0;font-size:1.4rem}
        .searchbar{display:flex;gap:8px;margin-top:12px}
        .searchbar input, .searchbar select{padding:10px;border-radius:8px;border:1px solid #ddd;background:white}
        .searchbar button{padding:10px 14px;border-radius:8px;border:0;background:#ff6f61;color:white;cursor:pointer}

        /* Layout principal */
        .grid{display:grid;grid-template-columns:1fr 320px;gap:20px;margin-top:18px}
        @media (max-width:900px){.grid{grid-template-columns:1fr;}.aside{order:2}}

        /* Tarjetas de producto */
        .products{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px}
        .card{background:white;border-radius:12px;box-shadow:0 6px 18px rgba(25,22,22,0.06);overflow:hidden;display:flex;flex-direction:column}
        .card img{width:100%;height:160px;object-fit:cover}
        .card .body{padding:12px;flex:1;display:flex;flex-direction:column}
        .card h3{margin:0 0 8px 0;font-size:1.05rem}
        .card p{margin:0 0 12px 0;color:#555;flex:1}
        .card .meta{display:flex;align-items:center;justify-content:space-between;gap:8px}
        .btn{padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
        .btn-primary{background:#3b2f63;color:white}
        .btn-ghost{background:transparent;border:1px solid #ddd}

        /* Carrito y aside */
        .aside{background:linear-gradient(180deg,#fff,#faf8fb);padding:16px;border-radius:12px;height:fit-content}
        .cart-item{display:flex;gap:12px;align-items:center;margin-bottom:12px}
        .cart-item img{width:64px;height:48px;object-fit:cover;border-radius:6px}
        .small{font-size:0.9rem;color:#555}

        footer{padding:20px;text-align:center;color:#666}

        /* Formulario admin simple */
        .admin{margin-top:18px;padding:12px;border-radius:10px;background:#fff}
        .admin input, .admin textarea{width:100%;padding:8px;margin:6px 0;border:1px solid #ddd;border-radius:6px}

        /* Accesibilidad simple */
        a, button{outline-color:#ff6f61}
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="brand">
                <svg width="44" height="44" viewBox="0 0 24 24" fill="none" aria-hidden="true"><rect width="24" height="24" rx="6" fill="#fff" opacity="0.08"/><path d="M6 18L18 6" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M6 6h12v12" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                <div>
                    <h1>Mercado Arte & Cultura</h1>
                    <div class="small">Productos seleccionados de artistas y creadores</div>
                </div>
            </div>

            <form class="searchbar" method="get" action="">
                <input aria-label="Buscar" type="search" name="search" placeholder="Buscar productos, p.ej. libro, pinceles" value="<?= htmlspecialchars($search) ?>">
                <select name="category" aria-label="Filtrar por categoría">
                    <?php foreach ($categories as $cat): ?>
                        <option value="<?= htmlspecialchars($cat) ?>" <?= $filter_category === $cat ? 'selected' : '' ?>><?= htmlspecialchars($cat) ?></option>
                    <?php endforeach ?>
                </select>
                <button type="submit">Buscar</button>
            </form>
        </div>
    </header>

    <main class="container">
        <div class="grid">
            <section>
                <h2>Productos</h2>
                <div class="products" role="list">
                    <?php if (count($visible_products) === 0): ?>
                        <div class="card" style="padding:20px">No se encontraron productos.</div>
                    <?php endif; ?>
                    <?php foreach ($visible_products as $p): ?>
                        <article class="card" role="listitem">
                            <img src="<?= htmlspecialchars($p['img']) ?>" alt="Imagen <?= htmlspecialchars($p['title']) ?>">
                            <div class="body">
                                <h3><?= htmlspecialchars($p['title']) ?></h3>
                                <p class="small"><?= htmlspecialchars($p['desc']) ?></p>
                                <div class="meta">
                                    <div><strong>$<?= number_format($p['price'], 2) ?></strong> <div class="small">Categoría: <?= htmlspecialchars($p['category']) ?></div></div>
                                    <form method="post" style="display:flex;gap:8px;align-items:center">
                                        <input type="hidden" name="action" value="add_to_cart">
                                        <input type="hidden" name="product_id" value="<?= $p['id'] ?>">
                                        <input type="number" name="quantity" value="1" min="1" style="width:64px;padding:6px;border-radius:6px;border:1px solid #ddd">
                                        <button class="btn btn-primary" type="submit">Añadir</button>
                                    </form>
                                </div>
                            </div>
                        </article>
                    <?php endforeach; ?>
                </div>
            </section>

            <aside class="aside" aria-label="Carrito y filtros">
                <h3>Carrito</h3>
                <?php if (empty($cart)): ?>
                    <div class="small">Tu carrito está vacío.</div>
                <?php else: ?>
                    <?php foreach ($cart as $id => $qty): $p = find_product($id); if (!$p) continue; ?>
                        <div class="cart-item">
                            <img src="<?= htmlspecialchars($p['img']) ?>" alt="Img <?= htmlspecialchars($p['title']) ?>">
                            <div style="flex:1">
                                <div><strong><?= htmlspecialchars($p['title']) ?></strong></div>
                                <div class="small"><?= $qty ?> × $<?= number_format($p['price'],2) ?></div>
                            </div>
                            <form method="post" style="margin:0">
                                <input type="hidden" name="action" value="remove_from_cart">
                                <input type="hidden" name="product_id" value="<?= $p['id'] ?>">
                                <button class="btn btn-ghost" type="submit">Eliminar</button>
                            </form>
                        </div>
                    <?php endforeach; ?>
                    <div style="border-top:1px dashed #ddd;padding-top:8px">Total: <strong>$<?= number_format(cart_total(), 2) ?></strong></div>
                    <div style="margin-top:8px"><button class="btn btn-primary" onclick="alert('Simulación: proceder a pago (no implementado)')">Pagar</button></div>
                <?php endif; ?>

                <div style="margin-top:18px">
                    <h4>Filtrar rápido</h4>
                    <?php foreach ($categories as $cat): if ($cat === 'Todas') continue; ?>
                        <div><a href="?category=<?= urlencode($cat) ?>" style="text-decoration:none;color:#3b2f63"><?= htmlspecialchars($cat) ?></a></div>
                    <?php endforeach; ?>
                </div>

                <div class="admin" aria-label="Agregar producto (demo)">
                    <h4>Agregar producto (demo)</h4>
                    <form method="post">
                        <input type="hidden" name="action" value="add_product">
                        <input name="title" placeholder="Título" required>
                        <input name="category" placeholder="Categoría" required>
                        <input name="price" type="number" step="0.01" placeholder="Precio" required>
                        <input name="img" placeholder="URL imagen (opcional)">
                        <textarea name="desc" placeholder="Descripción"></textarea>
                        <button class="btn btn-primary" type="submit">Agregar</button>
                    </form>
                    <small class="small">(Los productos se guardan en la sesión - se perderán al limpiar sesión)</small>
                </div>
            </aside>
        </div>

        <section style="margin-top:24px;background:white;padding:16px;border-radius:12px">
            <h3>Sobre nosotros</h3>
            <p class="small">Mercado Arte & Cultura apoya proyectos creativos: desde materiales para artistas hasta objetos culturales y libros. Este sitio es una plantilla ejemplo para aprender a combinar HTML, CSS y PHP.</p>
        </section>
    </main>

    <footer>
        <div class="container">
            <small>© <?= date('Y') ?> Mercado Arte & Cultura — Sitio demo hecho con PHP + HTML + CSS</small>
        </div>
    </footer>
</body>
</html>
